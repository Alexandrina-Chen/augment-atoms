# augment-atoms configuration file
# Enhanced with energy deviation filtering
#
# Usage: augment-atoms config.yaml

data:
  # Path to input structures (ASE-readable format)
  input: input.xyz 
  
  # Path to output file (structures will be appended)
  output: output.xyz

config:
  # Number of augmentations per starting structure
  n_per_structure: 10
  
  # Temperature for Boltzmann weighting (Kelvin)
  T: 300
  
  # Explore-vs-exploit trade-off [0, 1]
  # - beta=0: favor younger generations (more exploration)
  # - beta=1: favor lower energy structures (more exploitation)
  beta: 0.5
  
  # Range of standard deviations for position rattling (Å)
  sigma_range: [0.01, 0.1]
  
  # Random seed for reproducibility
  seed: 42
  
  # Cell perturbation standard deviation (Å)
  # Set to null for isolated systems or to disable cell perturbation
  cell_sigma: null
  
  # Energy units used by the calculator
  units: eV
  
  # Maximum force magnitude to consider relaxed (energy/Å)
  max_force: 30
  
  # Minimum allowed separation between atoms (Å)
  min_separation: 0.5
  
  # Maximum relaxation steps per child
  max_relax_steps: 20
  
  # RMSD threshold for considering structures too similar (Å)
  similarity_threshold: 0.1
  
  # ============================================================
  # Energy Deviation Filter (NEW)
  # ============================================================
  # Filter child structures based on energy deviation from parent.
  # Comment out or remove this section to disable filtering.
  #
  # Accepts child if: lower_bound <= deviation <= upper_bound
  # where deviation is computed based on the mode:
  #   - absolute: E_child - E_parent
  #   - per_atom: (E_child - E_parent) / n_atoms
  #   - relative: (E_child - E_parent) / |E_parent|
  
  energy_deviation:
    mode: per_atom        # 'absolute', 'per_atom', or 'relative'
    lower_bound: -0.2     # Accept children up to 0.2 eV/atom LOWER
    upper_bound: 0.5      # Accept children up to 0.5 eV/atom HIGHER
  
  # Maximum attempts to generate acceptable child (when filtering)
  max_filter_attempts: 10

model:
  # Calculator configuration
  # Options:
  #   +lennard_jones()
  #   +graph_pes_calculator: {path: model.pt}
  #   +my_module.my_function()
  
  calculator:
    +graph_pes_calculator:
      path: model.pt

# ============================================================
# Additional Example Configurations
# ============================================================

# Example 1: Explore higher-energy structures only
# Good for finding transition states or metastable configurations
#
# energy_deviation:
#   mode: per_atom
#   lower_bound: 0.1      # At least 0.1 eV/atom higher
#   upper_bound: 1.0      # At most 1.0 eV/atom higher

# Example 2: Stay close to parent energy
# Good for generating training data near equilibrium
#
# energy_deviation:
#   mode: absolute
#   lower_bound: -0.5     # ±0.5 eV total
#   upper_bound: 0.5

# Example 3: Percentage-based filtering
# Useful when working with systems of varying sizes
#
# energy_deviation:
#   mode: relative
#   lower_bound: -0.10    # Up to 10% lower
#   upper_bound: 0.25     # Up to 25% higher

# Example 4: Only allow lower energy structures
# For optimization/basin hopping style exploration
#
# energy_deviation:
#   mode: per_atom
#   lower_bound: -1.0     # Allow much lower energies
#   upper_bound: 0.0      # Reject any higher energy

# Example 5: Shorthand notation
# Just specify [lower, upper] (assumes per_atom mode)
#
# energy_deviation: [-0.1, 0.5]

# Example 6: Disable energy filtering
# Simply comment out or remove the energy_deviation section
#
# energy_deviation: null